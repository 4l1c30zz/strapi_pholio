<template>
  <div>
    <header id="site-header">
      <div class="wrap boxed">
        <div class="logo">
          <router-link to="/" v-slot="{ isActive,href, route, navigate }">
            <a :href="href" @click="navigate">
              <logo></logo>
            </a>
          </router-link>
        </div>

        <ul class="nav">
           <span @click="menuShowHide" class="menu_toggler heading">menu </span>
          <div class="nav_inner_i_wrap">

          <li class="mark_block_wrap">
            <router-link
             to="/blog" v-slot="{ isActive, href, route, navigate }"
             class="word"
             >
              <a
               :class="[isActive ? ' router-link-active' : '']"
               :href="href"
                @click="navigate">{{ route.name }}</a>
            </router-link>
            <div class="mark yellow"></div>
          </li>

          <li v-for="category in categories" v-bind:key="category.id">
            <router-link
             :to="{ path: '/category/' + category.id }"
             :key="category.id"
             >
              {{ category.name }}
            </router-link>
          </li>
          </div>
        </ul>
      </div>
    </header>

  </div>
</template>

<script>
import gql from "graphql-tag";
import logo from "../assets/logo";

export default {
  name: "headerComponent",
  data() {
    return {
      categories: []
    };
  },
  apollo: {
    categories: gql `
      query Categories {
        categories {
          id
          name
        }
      }
    `
  },
  components: {
    logo
  },
  mounted() {
    //callback on mounting to check the first position to avoid vier appearence on reload in the middle of the page
    sticky()
  },
  methods: {
    menuShowHide: function () {
      let mobileNavtogglerItems = document.querySelectorAll('.nav_inner_i_wrap, .menu_toggler');
      mobileNavtogglerItems.forEach(mobileNavtogglerItem => mobileNavtogglerItem.classList.toggle("a"));
    },

  }

};
//sticky header function
function sticky() {
  let siteHeader = document.getElementById("site-header");
  let siteHeaderHeight = siteHeader.offsetHeight;
  //if scrolled part is higher than header add class
  if (window.pageYOffset >= siteHeaderHeight) {
    siteHeader.classList.add("a");
  } else {
    siteHeader.classList.remove("a");
  }
}

function body_class_switcher() {

  let body = document.querySelector("body");
  //reset body class every time that function runs to avoid resize bugs
  body.className = '';
  //set default screen sizes for future media queries
  let desktop = window.matchMedia("(min-width: 1331px)");
  let laptop = window.matchMedia("(min-width:1025px) and (max-width:1330px)");
  let tablet = window.matchMedia("(min-width:769px) and (max-width:1024px)");
  let mobile = window.matchMedia("(min-width:400px) and (max-width:768px)");
  let tiny_mobile = window.matchMedia("(max-width:430px)");

  //if resolution matches the body gets the maching class
  if ((desktop).matches) {
    body.classList.add('desktop');
  }

  if ((laptop).matches) {
    body.classList.add('laptop');
  }

  if ((tablet).matches) {
    body.classList.add('tablet');
  }

  if ((mobile).matches) {
    body.classList.add('mobile');
  }
  if ((tiny_mobile).matches) {
    body.classList.add('tiny', 'mobile');
  }

}
//check the resolution oload
window.onload = function () {
  body_class_switcher();
}
//check the resolution on resize
window.onresize = function () {
  body_class_switcher();
}
//stick the header onscroll
window.onscroll = function () {
  sticky()
};

</script>
<style lang="scss">
@import "@/scss/_reset.scss";
@import "@/scss/_variables.scss";
@import "@/scss/_functions.scss";
@import "@/scss/_mixins.scss";
@import "@/scss/_globals.scss";

header {
  position: static;
  background: transparent;
  transition: all 0.3 ease;

  .wrap.boxed {
    width: 100%;
  }

  .logo {
    flex-basis: 30%;
    text-align: left;

    svg {
      max-width: 90px;
      margin: 0 auto;
      transition: all 0.3s ease;
    }

    path {
      fill: color(_gray);
      stroke: color(_gray);
    }

    a {
      display: block;
      text-align: left;
    }
  }

  .nav {
    flex-basis: 70%;

    .nav_inner_i_wrap {
      @extend %flex-center-end;
    }

    .menu_toggler {
      display: none;
      position: absolute;
      top: -5%;
      transition: $trans_default;
    }

    li {
      margin: $med_marg;
    }

    a {
      font-size: font_size(f20);
      transition: $trans-default;
      background: transparent;
      &.router-link-active{
        background: color(_yellow);
      }
    }
  }

  &.a {
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 10;
    background: color(_magenta);

    .logo svg {
      max-width: 70px;
    }
  }
}

#morph {
  pointer-events: none;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  z-index: -1;

  path {
    fill: color(_magenta);
  }
}


body {

  &.tablet,
  &.mobile {
    #site-header {
      .nav {
        li{
          
        }
        .menu_toggler {
          display: block;
          right: 0;
          top: 5%;
          padding: $inner_padd;
          z-index: 25;
          &:before , &:after{
            content: "";
            display: block;
            background: color(_black);
            width: 4px;
            height: 0px;
            position: absolute;
            top: -20vh;
            transition: $trans-default;
          }
          &:before{
            transform: rotate(40deg);
          }
          &:after{
             transform: rotate(-40deg);
          }
          &.a{
            font-size: 0;
            right: 3%;
            &:hover{
              transform: rotate(180deg) scale(1.3);
            }
             &:before , &:after{
               height: 25px;
                top: 0;
             }
          }
        }

        .nav_inner_i_wrap {
          @extend %flex-center-center-column;
          position: fixed;
          height: 100%;
          top: 0;
          right: -50vw;
          z-index: 20;
          background: color(_magenta);
          padding: 0 20px;
          transition: $trans-default;

          &.a {
            right: 0;
          }
        }
      }
    }
  }
}
</style>
